
<html>

<head>
<title>Learning WebGL &mdash; lesson 5</title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<script type="text/javascript" src="glMatrix-0.9.5.min.js"></script>
<script type="text/javascript" src="webgl-utils.js"></script>
<script type="text/javascript" src="webgl-obj-loader.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<script id="shader-fs" type="x-shader/x-fragment">
precision highp float;

varying vec4 mvPosition;
varying vec4 shadowTexCoord;

varying vec2 vTextureCoord;
varying vec3 transformedNormal;

uniform sampler2D uSampler;
uniform sampler2D uDepthSampler;

uniform float uAlpha;
uniform bool layerTextures;
uniform bool useTexture;
uniform float uPhongComponent;

varying vec3 vLightWeighting;
uniform vec3 uLightingDirection;
uniform vec3 pointLightPosition;

uniform vec3 uAmbientColor;
uniform vec3 uPointLightDiffuseColor;
uniform vec3 uPointLightSpecularColor;

uniform vec3 uMaterialDiffuseColor;

void main(void) {
        vec3 lightDirection = normalize(pointLightPosition - mvPosition.xyz);

        //Get the specular effects due to light
        vec3 normal = normalize(transformedNormal);
        vec3 eyeDirection = normalize(-mvPosition.xyz);
        vec3 reflectionDirection = reflect(-lightDirection, normal);
        float specularLightWeighting = pow(max(dot(reflectionDirection, eyeDirection), 0.0), uPhongComponent);

        float diffuseLightWeighting = max(dot(normal, lightDirection), 0.0);

        vec3 vLightWeighting = uAmbientColor + uPointLightDiffuseColor * diffuseLightWeighting + uPointLightSpecularColor * specularLightWeighting;
        vec4 fragColor = vec4(0.0, 0.0, 0.0, 1.0);
        if(useTexture) {
            vec4 textureColor1 = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
            vec4 textureColor2 = texture2D(uDepthSampler, vec2(vTextureCoord.s, vTextureCoord.t));

            vec4 textureColor = vec4(0.0, 0.0, 0.0, 1.0);
            if(layerTextures)
                textureColor = vec4(textureColor1.r + textureColor2.r*0.6, textureColor1.g + textureColor2.g*0.35, textureColor1.b + textureColor2.b*0.7, 1.0);
            else
                textureColor = textureColor1;

            fragColor = vec4(textureColor.rgb * vLightWeighting, textureColor.a * uAlpha);
        } else {
            fragColor = vec4( uMaterialDiffuseColor * diffuseLightWeighting, uAlpha);
        }
        gl_FragColor = fragColor;
}
</script>

<script id="shader-vs" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    attribute vec3 aVertexNormal;
    attribute vec2 aTextureCoord;

    uniform float uMaterialShininess;
    uniform bool uShowSpecularHighlights;

    uniform mat4 uMMatrix;
    uniform mat4 uVMatrix;
    uniform mat4 uPMatrix;
    uniform mat3 uNMatrix;
    uniform mat4 lightMVMatrix;

    varying vec2 vTextureCoord;
    varying vec4 mvPosition;
    varying vec4 shadowTexCoord;
    varying vec3 transformedNormal;

    uniform bool isLighting;
    uniform bool layerTextures;

    void main(void) {
        mvPosition = uVMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
        gl_Position = uPMatrix * mvPosition;
        vTextureCoord = aTextureCoord;

        //Transform the point normal due to rotation
        transformedNormal = uNMatrix * aVertexNormal;
    }
</script>
<script type="text/javascript" src="illusion.js"></script>

</head>

<body onload="initIllusion();">

    <canvas id="prabhat-canvas" style="border: none;" width="940" height="620"></canvas>

</body>
<button type="button" onclick="toggleTransparency()">Transparency</button>

</html>
